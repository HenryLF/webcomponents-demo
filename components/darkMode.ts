import Alpine from "alpinejs";
import { WebComponentFactory } from "../lib/WebComponentFactory";

const html = /*html*/ `
<button
  @click="$store.darkMode.toggle()"
  class="button fixed right-small top-small flex items-center space-x-2"
>
  <template x-if="$store.darkMode.on">
  <svg
  xmlns="http://www.w3.org/2000/svg"
  xml:space="preserve"
  width="20"
  height="20"
  viewBox="0 0 59.988 59.916"
  class="size-5"
  fill="currentColor"
>
  <path
    d="M26.753 49.746c-5.071-.919-9.755-3.777-12.764-7.789-1.785-2.38-3.267-5.858-3.736-8.77-.352-2.18-.137-6.324.434-8.384 1.912-6.896 7.415-12.386 14.158-14.125 1.621-.418 3.152-.7 3.152-.58 0 .033-.358.686-.795 1.451s-1.04 2.142-1.34 3.06c-.463 1.415-.56 2.018-.633 3.966-.14 3.706.597 6.436 2.513 9.316 1.073 1.612 3.23 3.727 4.697 4.604 2.908 1.738 5.498 2.4 8.884 2.266 2.956-.116 5.011-.698 7.271-2.061.64-.386 1.208-.702 1.263-.702.156 0-.074 1.341-.54 3.151-1.739 6.741-7.202 12.22-14.125 14.164-1.443.406-2.056.474-4.648.523-1.643.03-3.348-.01-3.79-.09"
  />
</svg>
  </template>
  <template x-if="!$store.darkMode.on">
<svg
  xmlns="http://www.w3.org/2000/svg"
  xml:space="preserve"
  width="20"
  height="20"
  viewBox="0 0 76.694 76.694" 
  fill="currentColor"

  class="size-5"

>
  <g style="display: inline">
    <path
      d="M103.85 186.38c-.365-.403-.437-1.124-.437-4.365 0-3.529.048-3.93.529-4.41.29-.292.767-.53 1.058-.53s.767.238 1.058.53c.482.48.53.881.53 4.456 0 3.47-.057 3.979-.484 4.366-.64.578-1.708.556-2.254-.046M77.8 175.7c-.174-.175-.317-.684-.317-1.13 0-.677.45-1.26 2.717-3.519 2.249-2.241 2.855-2.707 3.519-2.707 1.019 0 1.437.42 1.437 1.446 0 .678-.45 1.26-2.716 3.52-2.249 2.24-2.855 2.707-3.52 2.707-.44 0-.945-.143-1.12-.318m49.751-2.4c-2.241-2.249-2.707-2.855-2.707-3.519 0-1.019.42-1.437 1.446-1.437.678 0 1.26.45 3.52 2.716 2.24 2.249 2.707 2.855 2.707 3.52 0 1.018-.421 1.437-1.447 1.437-.677 0-1.26-.45-3.519-2.717m-26.649-8.294c-2.936-.71-5.344-2.123-7.826-4.593-3.482-3.466-5.002-7.085-5.002-11.913 0-4.804 1.517-8.411 5.013-11.924 3.466-3.482 7.085-5.002 11.913-5.002 4.804 0 8.411 1.517 11.924 5.013 3.482 3.466 5.002 7.085 5.002 11.913 0 4.804-1.517 8.411-5.013 11.924-2.506 2.518-4.839 3.868-7.944 4.597-2.13.501-5.963.494-8.067-.015m-33.829-15.402c-.578-.64-.556-1.708.046-2.254.404-.365 1.125-.437 4.366-.437 3.529 0 3.93.048 4.41.529.292.29.53.767.53 1.058s-.238.767-.53 1.058c-.48.482-.881.53-4.456.53-3.47 0-3.979-.057-4.366-.484m67.031-.046c-.29-.29-.529-.767-.529-1.058s.238-.767.53-1.058c.48-.482.881-.53 4.456-.53 3.47 0 3.979.057 4.366.484.578.64.556 1.708-.046 2.254-.404.365-1.125.438-4.366.438-3.529 0-3.93-.049-4.41-.53M80.191 125.94c-2.242-2.249-2.708-2.855-2.708-3.52 0-1.018.421-1.437 1.447-1.437.677 0 1.26.45 3.519 2.717 2.241 2.249 2.707 2.855 2.707 3.519 0 1.019-.42 1.437-1.446 1.437-.678 0-1.26-.45-3.52-2.716m44.97 2.399c-.174-.175-.317-.683-.317-1.13 0-.677.45-1.26 2.716-3.518 2.249-2.241 2.855-2.708 3.52-2.708 1.018 0 1.437.421 1.437 1.447 0 .677-.45 1.26-2.717 3.519-2.249 2.241-2.855 2.707-3.519 2.707-.441 0-.945-.143-1.12-.317m-21.22-8.943c-.481-.482-.528-.882-.528-4.457 0-3.47.056-3.979.483-4.366.64-.578 1.708-.556 2.254.046.365.404.438 1.125.438 4.366 0 3.529-.049 3.93-.53 4.41-.29.292-.767.53-1.058.53s-.767-.238-1.058-.53"
      style="stroke-width: 0.264583"
      transform="translate(-66.653 -110.153)"
    />
  </g>
</svg>
  </template>
  <span x-text="$store.darkMode.on ? 'Dark' : 'Light'"></span>
</button>
`;

function storeDarkMode(enabled: boolean) {
  localStorage.setItem("darkMode", enabled ? "enabled" : "disabled");
}

function isDarkModeEnabled() {
  if (!localStorage.getItem("darkMode")) {
    storeDarkMode(matchMedia("(prefers-color-scheme: dark)").matches);
  }
  return localStorage.getItem("darkMode") == "enabled";
}

const darkMode = {
  _: isDarkModeEnabled(),
  set on(v: boolean) {
    storeDarkMode(v);
    this._ = v;
  },
  get on() {
    return this._;
  },
  toggle() {
    this._ = !this._;
  },
};

Alpine.store("darkMode", darkMode);
WebComponentFactory("darkmode-btn", html, { noShadow: true });
